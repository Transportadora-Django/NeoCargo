{% extends 'base.html' %}
{% load static %}

{% block title %}{{ titulo }} - NeoCargo{% endblock %}

{% block extra_css %}
<style>
.cotacao-card {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.cotacao-card:hover {
    border-color: #007bff;
    box-shadow: 0 4px 8px rgba(0,123,255,0.2);
}

.cotacao-card.selected {
    border-color: #007bff;
    background-color: #f8f9ff;
}

.badge-preco {
    font-size: 1.2em;
    font-weight: bold;
}

.info-item {
    margin-bottom: 0.5rem;
}

.info-item strong {
    color: #495057;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-1">{{ titulo }}</h1>
                    <p class="text-muted mb-0">Escolha a opção que melhor se adequa às suas necessidades</p>
                </div>
                <a href="{% url 'pedidos:listar' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-list me-2"></i>
                    Meus Pedidos
                </a>
            </div>

            <!-- Resumo do Pedido -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        Resumo da Solicitação
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="info-item">
                                <strong>Origem:</strong><br>
                                {{ pedido.cidade_origem }}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="info-item">
                                <strong>Destino:</strong><br>
                                {{ pedido.cidade_destino }}
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="info-item">
                                <strong>Peso:</strong><br>
                                {{ pedido.peso_carga }} kg
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="info-item">
                                <strong>Prazo desejado:</strong><br>
                                {{ pedido.prazo_desejado }} dias
                            </div>
                        </div>
                    </div>
                    {% if pedido.observacoes %}
                    <div class="mt-3">
                        <strong>Observações:</strong><br>
                        {{ pedido.observacoes }}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Opções de Cotação -->
            <form method="post" action="{% url 'pedidos:confirmar' pedido.id %}">
                {% csrf_token %}
                <div class="row mb-4">
                    <!-- Opção Econômica -->
                    <div class="col-lg-4 mb-4">
                        <div class="cotacao-card h-100 p-4" data-option="economico">
                            <div class="text-center mb-3">
                                <div class="form-check d-flex justify-content-center">
                                    <input class="form-check-input me-2" type="radio" name="opcao" value="economico" id="opcao_economico">
                                </div>
                                <h5 class="text-success mt-2">
                                    <i class="fas fa-dollar-sign me-2"></i>
                                    Mais Econômico
                                </h5>
                                <p class="text-muted small">Melhor preço com prazo estendido</p>
                            </div>
                            
                            <div class="text-center mb-3">
                                <div class="badge bg-success badge-preco">
                                    R$ {{ opcoes.economico.preco|floatformat:2 }}
                                </div>
                            </div>
                            
                            <div class="info-details">
                                <div class="info-item">
                                    <strong>Prazo:</strong><br>
                                    <span class="text-success">{{ opcoes.economico.prazo }}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Veículo:</strong><br>
                                    {{ opcoes.economico.veiculo }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Opção Rápida -->
                    <div class="col-lg-4 mb-4">
                        <div class="cotacao-card h-100 p-4" data-option="rapido">
                            <div class="text-center mb-3">
                                <div class="form-check d-flex justify-content-center">
                                    <input class="form-check-input me-2" type="radio" name="opcao" value="rapido" id="opcao_rapido">
                                </div>
                                <h5 class="text-primary mt-2">
                                    <i class="fas fa-tachometer-alt me-2"></i>
                                    Mais Rápido
                                </h5>
                                <p class="text-muted small">Entrega expressa com prioridade</p>
                            </div>
                            
                            <div class="text-center mb-3">
                                <div class="badge bg-primary badge-preco">
                                    R$ {{ opcoes.rapido.preco|floatformat:2 }}
                                </div>
                            </div>
                            
                            <div class="info-details">
                                <div class="info-item">
                                    <strong>Prazo:</strong><br>
                                    <span class="text-primary">{{ opcoes.rapido.prazo }}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Veículo:</strong><br>
                                    {{ opcoes.rapido.veiculo }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Opção Custo-Benefício -->
                    <div class="col-lg-4 mb-4">
                        <div class="cotacao-card h-100 p-4" data-option="custo_beneficio">
                            <div class="text-center mb-3">
                                <div class="form-check d-flex justify-content-center">
                                    <input class="form-check-input me-2" type="radio" name="opcao" value="custo_beneficio" id="opcao_custo_beneficio">
                                </div>
                                <h5 class="text-warning mt-2">
                                    <i class="fas fa-balance-scale me-2"></i>
                                    Melhor Custo-Benefício
                                </h5>
                                <p class="text-muted small">Equilíbrio ideal entre preço e prazo</p>
                            </div>
                            
                            <div class="text-center mb-3">
                                <div class="badge bg-warning badge-preco">
                                    R$ {{ opcoes.custo_beneficio.preco|floatformat:2 }}
                                </div>
                            </div>
                            
                            <div class="info-details">
                                <div class="info-item">
                                    <strong>Prazo:</strong><br>
                                    <span class="text-warning">{{ opcoes.custo_beneficio.prazo }}</span>
                                </div>
                                <div class="info-item">
                                    <strong>Veículo:</strong><br>
                                    {{ opcoes.custo_beneficio.veiculo }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <a href="{% url 'pedidos:criar' %}" class="btn btn-outline-secondary me-md-2">
                        <i class="fas fa-arrow-left me-2"></i>
                        Voltar
                    </a>
                    <button type="submit" class="btn btn-success btn-lg" id="btnConfirmar" disabled>
                        <i class="fas fa-check me-2"></i>
                        Confirmar Pedido
                    </button>
                </div>
            </form>

            <!-- Informações Importantes -->
            <div class="alert alert-info mt-4">
                <h6 class="alert-heading">
                    <i class="fas fa-info-circle me-2"></i>
                    Informações Importantes
                </h6>
                <ul class="mb-0 small">
                    <li>Os preços são estimativos e podem sofrer alterações após análise detalhada</li>
                    <li>Os prazos começam a contar após a confirmação e coleta da mercadoria</li>
                    <li>Nossa equipe entrará em contato para finalizar os detalhes</li>
                    <li>Você pode acompanhar o status do pedido na página "Meus Pedidos"</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.cotacao-card');
    const radios = document.querySelectorAll('input[name="opcao"]');
    const btnConfirmar = document.getElementById('btnConfirmar');
    
    // Adicionar event listeners para os cards
    cards.forEach(card => {
        card.addEventListener('click', function() {
            const option = this.dataset.option;
            const radio = document.querySelector(`input[value="${option}"]`);
            
            // Remove seleção de todos os cards
            cards.forEach(c => c.classList.remove('selected'));
            
            // Adiciona seleção ao card clicado
            this.classList.add('selected');
            
            // Marca o radio button
            radio.checked = true;
            
            // Habilita o botão confirmar
            btnConfirmar.disabled = false;
        });
    });
    
    // Event listeners para os radio buttons
    radios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {
                btnConfirmar.disabled = false;
                
                // Atualiza visual dos cards
                cards.forEach(card => {
                    card.classList.remove('selected');
                    if (card.dataset.option === this.value) {
                        card.classList.add('selected');
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}